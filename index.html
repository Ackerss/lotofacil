<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LotoAnalytic Pro - Sistema de Intelig√™ncia</title>
    
    <!-- 1. Estilos (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Bibliotecas React e Recharts via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <!-- 3. Babel para rodar JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Configura√ß√£o de Cores do Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 750: '#2d3748', 850: '#1a202c', 950: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <style>
        /* Anima√ß√µes e ajustes finos */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .recharts-wrapper { direction: ltr; } /* Fix para gr√°ficos */
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans selection:bg-emerald-500 selection:text-white overflow-x-hidden">
    
    <div id="root"></div>

    <!-- C√ìDIGO DA APLICA√á√ÉO -->
    <script type="text/babel">
        // --- 1. CONFIGURA√á√ïES E UTILS ---
        const { useState, useEffect, useMemo, useRef } = React;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip: RechartsTooltip, 
            ResponsiveContainer, PieChart, Pie, Cell, Legend 
        } = Recharts;

        // Link do seu Apps Script (J√Å CONFIGURADO)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwbeoQHQpVz9unauVFQtTVLX2hjR9vOhAcwWoqLICReKelBowYthmEyohFrAY9pq4sw6g/exec';

        // --- 2. PACOTE DE √çCONES (SVG Inline para evitar depend√™ncias externas quebradas) ---
        const Icons = {
            LayoutDashboard: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
            Database: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>,
            Calculator: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
            Zap: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Save: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Download: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            RefreshCw: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            TrendingUp: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            AlertCircle: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Search: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Grid3X3: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></svg>,
            Filter: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
            Upload: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Menu: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            X: ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        };

        // --- 3. COMPONENTES AUXILIARES ---
        const NavItem = ({ icon: Icon, label, active, onClick }) => (
            <button 
                onClick={onClick}
                className={`w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-all
                ${active 
                    ? 'bg-emerald-500/10 text-emerald-400 border-r-2 border-emerald-500 rounded-r-none' 
                    : 'text-slate-400 hover:bg-slate-800 hover:text-slate-200'
                }`}
            >
                <Icon size={20} />
                <span className="hidden md:block">{label}</span>
            </button>
        );

        const KpiCard = ({ title, value, sub, icon }) => (
            <div className="bg-slate-800 border border-slate-700 p-5 rounded-xl flex items-start justify-between hover:border-slate-600 transition-colors shadow-md">
                <div>
                    <p className="text-slate-400 text-sm font-medium mb-1">{title}</p>
                    <h3 className="text-2xl font-bold text-white">{value}</h3>
                    {sub && <p className="text-emerald-400 text-xs mt-1">{sub}</p>}
                </div>
                <div className="p-3 bg-slate-900 rounded-lg border border-slate-700">
                    {icon}
                </div>
            </div>
        );

        const Ball = ({ number, active, size = 'md' }) => {
            const sizes = { sm: 'w-6 h-6 text-xs', md: 'w-10 h-10 text-base', lg: 'w-12 h-12 text-lg', xl: 'w-14 h-14 text-xl' };
            
            // L√≥gica de Cores da Lotof√°cil
            let bg = active ? 'bg-gradient-to-br from-purple-500 to-purple-700' : 'bg-slate-700';
            if (active) {
                if (number <= 5) bg = 'bg-gradient-to-br from-red-500 to-red-600'; // linha 1
                else if (number <= 10) bg = 'bg-gradient-to-br from-yellow-500 to-yellow-600';
                else if (number <= 15) bg = 'bg-gradient-to-br from-emerald-500 to-emerald-600';
                else if (number <= 20) bg = 'bg-gradient-to-br from-blue-500 to-blue-600';
                else bg = 'bg-gradient-to-br from-indigo-500 to-indigo-600';
            }

            return (
                <div className={`${sizes[size]} rounded-full flex items-center justify-center font-bold text-white shadow-lg ${bg} transition-transform hover:scale-110 cursor-default border-2 border-white/10`}>
                {number}
                </div>
            );
        };

        const ControlSlider = ({ label, val, min, max, onChange, desc }) => (
            <div>
                <div className="flex justify-between mb-2">
                    <label className="text-sm font-medium text-slate-300">{label}</label>
                    <span className="text-emerald-400 font-mono font-bold">{val}</span>
                </div>
                <input 
                    type="range" min={min} max={max} value={val} 
                    onChange={(e) => onChange(parseInt(e.target.value))}
                    className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                />
                {desc && <p className="text-xs text-slate-500 mt-1">{desc}</p>}
            </div>
        );

        const StatBadge = ({ label, value, ideal }) => (
            <div className="text-center p-3 bg-slate-900/50 rounded-lg border border-slate-700">
                <div className="text-xs text-slate-400 uppercase">{label}</div>
                <div className="text-xl font-bold text-white my-1">{value}</div>
                <div className="text-[10px] text-emerald-500">Meta: {ideal}</div>
            </div>
        );

        const ResultRow = ({ label, value, good }) => (
            <div className="flex justify-between items-center py-2 border-b border-slate-700 last:border-0">
                <span className="text-slate-300">{label}</span>
                <span className={`font-bold ${good ? 'text-emerald-400' : 'text-slate-500'}`}>{value}</span>
            </div>
        );

        // --- 4. ABAS E L√ìGICA DO APP ---
        
        // 4.1 Dashboard
        const DashboardTab = ({ stats, lastGame }) => {
            const chartData = stats.freq.slice(1).map((val, idx) => ({ name: idx + 1, freq: val }));

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <KpiCard title="Total de Concursos" value={stats.totalGames} icon={<Icons.Database size={20} className="text-blue-400"/>} />
                        <KpiCard title="Soma M√©dia" value={stats.avgSum} sub="Ideal: 180 - 220" icon={<Icons.Calculator size={20} className="text-emerald-400"/>} />
                        <KpiCard title="M√©dia Pares" value={stats.avgEven} sub="Ideal: 7 ou 8" icon={<Icons.Filter size={20} className="text-purple-400"/>} />
                        <KpiCard title="Repetidas (M√©dia)" value="9" sub="Do anterior" icon={<Icons.RefreshCw size={20} className="text-orange-400"/>} />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-md">
                            <div className="flex justify-between items-center mb-6">
                                <h3 className="text-lg font-semibold text-white">√öltimo Resultado (Conc. {lastGame.concurso})</h3>
                                <span className="text-sm text-slate-400">{lastGame.data}</span>
                            </div>
                            <div className="flex flex-wrap gap-3 justify-center">
                                {lastGame.bolas.map(num => (
                                <Ball key={num} number={num} active={true} size="lg" />
                                ))}
                            </div>
                            <div className="mt-6 flex justify-center gap-6 text-sm text-slate-400">
                                <span className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-emerald-500"></span>
                                Soma: {lastGame.bolas.reduce((a,b)=>a+b,0)}
                                </span>
                                <span className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-blue-500"></span>
                                Pares: {lastGame.bolas.filter(n => n % 2 === 0).length}
                                </span>
                            </div>
                        </div>

                        <div className="bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-md">
                            <h3 className="text-lg font-semibold text-white mb-4">N√∫meros Quentes üî•</h3>
                            <div className="space-y-3">
                                {stats.hot.slice(0, 5).map((item, idx) => (
                                <div key={item.num} className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                    <span className="text-slate-500 font-mono w-4">{idx + 1}</span>
                                    <Ball number={item.num} size="sm" active />
                                    </div>
                                    <div className="w-24 bg-slate-700 rounded-full h-2 overflow-hidden">
                                    <div className="bg-orange-500 h-full" style={{ width: `${(item.count / stats.totalGames) * 100}%` }}></div>
                                    </div>
                                    <span className="text-xs text-slate-400">{item.count}x</span>
                                </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-md">
                        <h3 className="text-lg font-semibold text-white mb-6">Frequ√™ncia Geral</h3>
                        <div className="h-64 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart data={chartData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false} />
                                <XAxis dataKey="name" stroke="#94a3b8" tick={{fontSize: 12}} />
                                <YAxis stroke="#94a3b8" tick={{fontSize: 12}} />
                                <RechartsTooltip 
                                    contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#f8fafc' }}
                                    cursor={{ fill: '#334155', opacity: 0.4 }}
                                />
                                <Bar dataKey="freq" fill="#10B981" radius={[4, 4, 0, 0]} />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>
            );
        };

        // 4.2 An√°lise
        const AnalysisTab = ({ stats }) => {
            // Heatmap
            const matrix = Array(5).fill(null).map(() => Array(5).fill(0));
            stats.freq.forEach((freq, num) => {
                if (num === 0) return;
                const row = Math.floor((num - 1) / 5);
                const col = (num - 1) % 5;
                matrix[row][col] = freq;
            });
            const maxFreq = Math.max(...stats.freq.slice(1));

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 animate-fade-in">
                    <div className="bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-md">
                        <h3 className="text-lg font-semibold text-white mb-4">Pares x √çmpares</h3>
                        <p className="text-sm text-slate-400 mb-4">Equil√≠brio ideal: 8 √çmpares / 7 Pares.</p>
                        <div className="h-64 flex justify-center">
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                <Pie
                                    data={[
                                    { name: '√çmpares', value: stats.totalGames * 15 - (stats.avgEven * stats.totalGames) },
                                    { name: 'Pares', value: stats.avgEven * stats.totalGames },
                                    ]}
                                    cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value"
                                >
                                    <Cell fill="#8B5CF6" />
                                    <Cell fill="#10B981" />
                                </Pie>
                                <Legend verticalAlign="bottom" height={36}/>
                                <RechartsTooltip />
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    <div className="bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-md">
                        <h3 className="text-lg font-semibold text-white mb-4">Mapa de Calor (Clusters)</h3>
                        <p className="text-sm text-slate-400 mb-6">Regi√µes mais sorteadas da cartela.</p>
                        <div className="grid grid-cols-5 gap-2 max-w-xs mx-auto aspect-square">
                        {matrix.map((row, rIdx) => (
                            row.map((val, cIdx) => {
                            const num = rIdx * 5 + cIdx + 1;
                            const intensity = val / maxFreq;
                            return (
                                <div 
                                key={num} 
                                className="rounded-lg flex items-center justify-center text-sm font-bold border border-slate-700 transition-all hover:scale-105"
                                style={{
                                    backgroundColor: `rgba(16, 185, 129, ${intensity})`,
                                    color: intensity > 0.5 ? '#fff' : '#94a3b8'
                                }}
                                title={`N√∫mero ${num}: ${val} vezes`}
                                >
                                {num}
                                </div>
                            );
                            })
                        ))}
                        </div>
                    </div>

                    <div className="bg-slate-800 border border-slate-700 rounded-xl p-6 col-span-1 md:col-span-2 shadow-md">
                        <h3 className="text-lg font-semibold text-white mb-4">N√∫meros Frios (Atrasados)</h3>
                        <div className="flex gap-4 overflow-x-auto pb-2 scrollbar-hide">
                        {stats.cold.map((item) => (
                            <div key={item.num} className="flex flex-col items-center bg-slate-900 p-4 rounded-lg min-w-[100px] border border-slate-700">
                            <Ball number={item.num} active={false} />
                            <span className="mt-2 text-lg font-bold text-slate-300">{item.count}</span>
                            <span className="text-xs text-slate-500">apari√ß√µes</span>
                            </div>
                        ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 4.3 Gerador
        const GeneratorTab = ({ stats, lastGame, saveGame }) => {
            const [config, setConfig] = useState({ numOdd: 8, sumMin: 180, sumMax: 220, repeats: 9, balanced: true });
            const [generated, setGenerated] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);

            const generateGame = () => {
                setIsGenerating(true);
                setTimeout(() => {
                    let attempts = 0;
                    let candidate = [];
                    let valid = false;
                    const lastDrawSet = new Set(lastGame.bolas);
                    const allNumbers = Array.from({length: 25}, (_, i) => i + 1);
                    const notInLast = allNumbers.filter(n => !lastDrawSet.has(n));
                    const inLast = Array.from(lastDrawSet);

                    while (!valid && attempts < 10000) {
                        attempts++;
                        candidate = [];
                        
                        // Mistura
                        const shuffledLast = [...inLast].sort(() => 0.5 - Math.random());
                        const shuffledNotLast = [...notInLast].sort(() => 0.5 - Math.random());
                        
                        // Sele√ß√£o baseada em repetidas
                        const pickedRepeats = shuffledLast.slice(0, config.repeats);
                        const needed = 15 - config.repeats;
                        const pickedOthers = shuffledNotLast.slice(0, needed);
                        
                        candidate = [...pickedRepeats, ...pickedOthers].sort((a,b) => a-b);

                        // Valida√ß√µes
                        const sum = candidate.reduce((a,b) => a+b, 0);
                        if (sum < config.sumMin || sum > config.sumMax) continue;

                        const oddCount = candidate.filter(n => n % 2 !== 0).length;
                        if (oddCount !== config.numOdd) continue;

                        valid = true;
                    }

                    if (valid) {
                        setGenerated({
                            id: Date.now(),
                            date: new Date().toLocaleDateString(),
                            numbers: candidate,
                            stats: {
                                sum: candidate.reduce((a,b)=>a+b,0),
                                odd: candidate.filter(n=>n%2!==0).length,
                                repeats: candidate.filter(n=>lastDrawSet.has(n)).length
                            }
                        });
                    } else {
                        alert("Regras muito restritas. Tente aumentar o intervalo de soma.");
                    }
                    setIsGenerating(false);
                }, 100);
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
                    <div className="bg-slate-800 border border-slate-700 rounded-xl p-6 h-fit shadow-md">
                        <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2">
                            <Icons.Zap className="text-emerald-400" size={24}/> Configurar Gerador
                        </h3>
                        
                        <div className="space-y-6">
                            <ControlSlider label="N√∫meros √çmpares" val={config.numOdd} min={5} max={11} onChange={(v) => setConfig({...config, numOdd: v})} desc="Recomendado: 7 ou 8" />
                            <div className="space-y-2">
                                <div className="flex justify-between">
                                    <label className="text-sm font-medium text-slate-300">Soma Total</label>
                                    <span className="text-emerald-400 font-mono">{config.sumMin} - {config.sumMax}</span>
                                </div>
                                <div className="flex gap-4 items-center">
                                    <input type="range" min="150" max="200" value={config.sumMin} onChange={(e) => setConfig({...config, sumMin: parseInt(e.target.value)})} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500" />
                                    <input type="range" min="200" max="250" value={config.sumMax} onChange={(e) => setConfig({...config, sumMax: parseInt(e.target.value)})} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500" />
                                </div>
                            </div>
                            <ControlSlider label="Repetir do √öltimo" val={config.repeats} min={5} max={11} onChange={(v) => setConfig({...config, repeats: v})} desc="M√©dia hist√≥rica: 9 repetidas" />
                            
                            <button onClick={generateGame} disabled={isGenerating} className="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-emerald-900/40 transition-all active:scale-95 flex items-center justify-center gap-2">
                                {isGenerating ? 'Calculando...' : 'GERAR JOGO OTIMIZADO'}
                            </button>
                        </div>
                    </div>

                    <div className="lg:col-span-2 space-y-6">
                        {generated ? (
                            <div className="bg-slate-800 border border-emerald-500/30 rounded-xl p-8 animate-fade-in relative overflow-hidden shadow-lg">
                                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 to-blue-500"></div>
                                <div className="flex justify-between items-start mb-8">
                                    <div>
                                        <h2 className="text-2xl font-bold text-white mb-2">Jogo Gerado</h2>
                                        <p className="text-slate-400 text-sm">Baseado nas estat√≠sticas.</p>
                                    </div>
                                    <button onClick={() => saveGame(generated)} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                                        <Icons.Save size={18} /> Salvar
                                    </button>
                                </div>
                                <div className="flex flex-wrap gap-4 justify-center mb-8">
                                    {generated.numbers.map(num => <Ball key={num} number={num} active size="xl" />)}
                                </div>
                                <div className="grid grid-cols-3 gap-4 border-t border-slate-700 pt-6">
                                    <StatBadge label="Soma Total" value={generated.stats.sum} ideal="180-220" />
                                    <StatBadge label="√çmpares" value={generated.stats.odd} ideal={`${config.numOdd}`} />
                                    <StatBadge label="Repetidas" value={generated.stats.repeats} ideal={`${config.repeats}`} />
                                </div>
                            </div>
                        ) : (
                            <div className="h-full flex flex-col items-center justify-center bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-12 text-slate-500">
                                <Icons.Grid3X3 size={64} className="mb-4 opacity-20" />
                                <p className="text-lg">Configure e clique em Gerar</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 4.4 Meus Jogos
        const MyGamesTab = ({ games, setGames, history }) => {
            const exportData = () => {
                const csvContent = "data:text/csv;charset=utf-8,Data,Numeros,Soma,Impares\n" 
                + games.map(g => `${g.date},"${g.numbers.join('-')}",${g.stats.sum},${g.stats.odd}`).join("\n");
                const link = document.createElement("a");
                link.setAttribute("href", encodeURI(csvContent));
                link.setAttribute("download", "meus_jogos.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const checkHits = (gameNumbers) => {
                if(!history.length) return 0;
                const last = new Set(history[0].bolas);
                return gameNumbers.filter(n => last.has(n)).length;
            };

            return (
                <div className="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden animate-fade-in shadow-md">
                    <div className="p-6 border-b border-slate-700 flex justify-between items-center">
                        <h3 className="text-lg font-bold text-white">Jogos Salvos ({games.length})</h3>
                        <button onClick={exportData} className="text-emerald-400 hover:text-emerald-300 flex items-center gap-2 text-sm font-medium">
                            <Icons.Download size={18} /> Exportar
                        </button>
                    </div>
                    {games.length === 0 ? (
                        <div className="p-12 text-center text-slate-500">Nenhum jogo salvo.</div>
                    ) : (
                        <div className="divide-y divide-slate-700 max-h-[500px] overflow-y-auto">
                            {games.map((game, idx) => (
                                <div key={game.id} className="p-6 flex flex-col md:flex-row items-center justify-between gap-4 hover:bg-slate-750 transition-colors">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-3 mb-3">
                                            <span className="text-slate-400 font-mono text-sm">#{games.length - idx}</span>
                                            <span className="bg-slate-700 text-slate-300 text-xs px-2 py-0.5 rounded">Soma: {game.stats.sum}</span>
                                        </div>
                                        <div className="flex flex-wrap gap-2">
                                            {game.numbers.map(n => (
                                                <span key={n} className="w-8 h-8 flex items-center justify-center rounded-full bg-slate-700 text-white font-bold text-sm border border-slate-600">{n}</span>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <div className="text-center px-4">
                                            <div className="text-xs text-slate-400 uppercase">Acertos √öltimo</div>
                                            <div className="text-2xl font-bold text-white">{checkHits(game.numbers)}</div>
                                        </div>
                                        <button onClick={() => setGames(games.filter(g => g.id !== game.id))} className="p-2 hover:bg-red-500/20 text-slate-500 hover:text-red-400 rounded transition-colors"><Icons.X size={20}/></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // 4.5 Simulador
        const SimulatorTab = ({ history }) => {
            const [inputStr, setInputStr] = useState("");
            const [result, setResult] = useState(null);

            const simulate = () => {
                const nums = inputStr.split(/[\s,-]+/).map(n => parseInt(n)).filter(n => !isNaN(n) && n > 0 && n <= 25);
                const unique = [...new Set(nums)];
                if (unique.length < 15) { alert("Insira 15 n√∫meros."); return; }
                const game = unique.slice(0, 15).sort((a,b)=>a-b);
                
                let maxHits = 0, hits15 = 0, hits14 = 0, bestConcurso = null;
                history.forEach(h => {
                    const hSet = new Set(h.bolas);
                    const hits = game.filter(x => hSet.has(x)).length;
                    if (hits > maxHits) { maxHits = hits; bestConcurso = h; }
                    if (hits === 15) hits15++;
                    if (hits === 14) hits14++;
                });

                setResult({ game, maxHits, hits15, hits14, bestConcurso, totalChecked: history.length });
            };

            const fillRandom = () => {
                const nums = new Set();
                while(nums.size < 15) nums.add(Math.floor(Math.random() * 25) + 1);
                setInputStr(Array.from(nums).sort((a,b)=>a-b).join(" "));
            };

            return (
                <div className="max-w-3xl mx-auto space-y-8 animate-fade-in">
                    <div className="bg-slate-800 border border-slate-700 rounded-xl p-8 shadow-md">
                        <h3 className="text-xl font-bold text-white mb-4">Simulador Hist√≥rico</h3>
                        <div className="relative mb-4">
                            <textarea value={inputStr} onChange={(e) => setInputStr(e.target.value)} placeholder="Digite 15 n√∫meros..." className="w-full bg-slate-900 border border-slate-700 rounded-lg p-4 text-white font-mono focus:ring-2 focus:ring-emerald-500 outline-none h-32 resize-none" />
                            <button onClick={fillRandom} className="absolute bottom-4 right-4 text-xs bg-slate-700 text-slate-300 px-3 py-1 rounded hover:bg-slate-600 transition-colors">Aleat√≥rio</button>
                        </div>
                        <button onClick={simulate} className="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2">
                            <Icons.Search size={20} /> CONSULTAR HIST√ìRICO
                        </button>
                    </div>
                    {result && (
                        <div className="bg-slate-800 border border-slate-700 rounded-xl overflow-hidden shadow-lg">
                            <div className="bg-slate-900/50 p-6 border-b border-slate-700 flex justify-center flex-wrap gap-2">
                                {result.game.map(n => <Ball key={n} number={n} active size="md"/>)}
                            </div>
                            <div className="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="space-y-4">
                                    <ResultRow label="J√° fez 15 pontos?" value={result.hits15 > 0 ? `SIM (${result.hits15}x)` : 'N√ÉO'} good={result.hits15 > 0} />
                                    <ResultRow label="J√° fez 14 pontos?" value={result.hits14 > 0 ? `SIM (${result.hits14}x)` : 'N√ÉO'} good={result.hits14 > 0} />
                                    <ResultRow label="M√°ximo de Acertos" value={`${result.maxHits}`} good={result.maxHits >= 14} />
                                </div>
                                <div>
                                    <h4 className="text-slate-400 text-sm uppercase mb-2">Melhor Resultado</h4>
                                    {result.bestConcurso ? (
                                        <div className="bg-slate-700/30 p-4 rounded-lg">
                                            <p className="text-white font-bold">Concurso {result.bestConcurso.concurso}</p>
                                            <p className="text-slate-400 text-sm">{result.bestConcurso.data}</p>
                                            <p className="mt-2 text-emerald-400 font-bold">{result.maxHits} acertos</p>
                                        </div>
                                    ) : <p className="text-slate-500">Sem dados.</p>}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- 5. COMPONENTE PRINCIPAL (APP) ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [myGames, setMyGames] = useState([]);
            const [menuOpen, setMenuOpen] = useState(false); // Mobile menu

            useEffect(() => {
                fetchData();
                const saved = localStorage.getItem('loto_my_games');
                if (saved) setMyGames(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('loto_my_games', JSON.stringify(myGames));
            }, [myGames]);

            const fetchData = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(APPS_SCRIPT_URL);
                    if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                    
                    const text = await response.text();
                    if (text.includes('<html')) throw new Error('Erro de permiss√£o no script. Verifique se publicou como "Qualquer Pessoa".');
                    
                    const parsedData = parseCSV(text);
                    if (!parsedData.length) throw new Error('Nenhum dado encontrado.');
                    setData(parsedData);
                } catch (err) {
                    console.error(err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const parseCSV = (csvText) => {
                const lines = csvText.split(/\r\n|\n/);
                const result = [];
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    // Regex para lidar com aspas do CSV
                    const cols = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if(!cols) continue;
                    
                    const cleanCols = cols.map(c => c.replace(/^"|"$/g, '').trim());
                    
                    // Extrai n√∫meros
                    const numbers = cleanCols
                        .map(c => parseInt(c))
                        .filter(n => !isNaN(n) && n > 0 && n <= 25);
                    const unique = [...new Set(numbers)];

                    if (unique.length >= 15) {
                        const bolas = unique.slice(0, 15).sort((a,b) => a-b);
                        // Tenta achar concurso e data
                        let concurso = parseInt(cleanCols[0]);
                        if(isNaN(concurso) || concurso <= 25) concurso = parseInt(cleanCols.find(c => parseInt(c) > 2000)) || (lines.length - i);
                        const dataStr = cleanCols.find(c => c.includes('/') && c.length <= 10) || 'N/A';
                        
                        result.push({ concurso, data: dataStr, bolas });
                    }
                }
                return result.sort((a,b) => b.concurso - a.concurso);
            };

            const loadDemo = () => {
                const demo = Array.from({length: 50}, (_, i) => ({
                    concurso: 3000 + i, data: 'Demo', 
                    bolas: Array.from({length: 15}, () => Math.floor(Math.random()*25)+1).sort((a,b)=>a-b)
                }));
                setData(demo); setError(null);
            };

            // Stats calculation
            const stats = useMemo(() => {
                if (!data.length) return null;
                const freq = Array(26).fill(0);
                let totalSum = 0, totalEven = 0;
                data.forEach(g => {
                    let s = 0;
                    g.bolas.forEach(n => { freq[n]++; s += n; if(n%2===0) totalEven++; });
                    totalSum += s;
                });
                const freqList = freq.map((c, n) => ({ num: n, count: c })).slice(1).sort((a, b) => b.count - a.count);
                return {
                    freq, hot: freqList.slice(0, 5), cold: freqList.slice(-5).reverse(),
                    avgSum: Math.round(totalSum / data.length),
                    avgEven: (totalEven / data.length).toFixed(1),
                    totalGames: data.length, lastGame: data[0]
                };
            }, [data]);

            const TabButton = ({ id, label, icon: Icon }) => (
                <button onClick={() => { setActiveTab(id); setMenuOpen(false); }} 
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${activeTab === id ? 'bg-emerald-500/20 text-emerald-400' : 'text-slate-400 hover:bg-slate-800'}`}>
                    <Icon size={20} /> {label}
                </button>
            );

            return (
                <div className="flex flex-col md:flex-row min-h-screen">
                    {/* Mobile Header */}
                    <div className="md:hidden flex items-center justify-between p-4 bg-slate-950 border-b border-slate-800">
                        <span className="font-bold text-lg text-white">Loto<span className="text-emerald-400">Analytic</span></span>
                        <button onClick={() => setMenuOpen(!menuOpen)} className="text-white"><Icons.Menu/></button>
                    </div>

                    {/* Sidebar */}
                    <div className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-950 border-r border-slate-800 transform ${menuOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 transition-transform duration-200 ease-in-out`}>
                        <div className="p-6 hidden md:block border-b border-slate-800">
                             <span className="font-bold text-xl text-white">Loto<span className="text-emerald-400">Analytic</span></span>
                        </div>
                        <nav className="p-4 space-y-2">
                            <TabButton id="dashboard" label="Dashboard" icon={Icons.LayoutDashboard} />
                            <TabButton id="analysis" label="An√°lise" icon={Icons.TrendingUp} />
                            <TabButton id="generator" label="Gerador" icon={Icons.Zap} />
                            <TabButton id="mygames" label="Meus Jogos" icon={Icons.Save} />
                            <TabButton id="simulator" label="Simulador" icon={Icons.Calculator} />
                        </nav>
                    </div>

                    {/* Main */}
                    <main className="flex-1 md:ml-64 p-4 md:p-8 overflow-y-auto">
                        <header className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <div>
                                <h1 className="text-2xl font-bold text-white capitalize">{activeTab}</h1>
                                <p className="text-slate-400 text-sm mt-1">{loading ? 'Carregando...' : `${data.length} concursos carregados`}</p>
                            </div>
                            <div className="flex gap-2">
                                {error && <button onClick={loadDemo} className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">Usar Demo</button>}
                                <button onClick={fetchData} disabled={loading} className="px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 flex items-center gap-2 disabled:opacity-50">
                                    <Icons.RefreshCw size={16} className={loading ? 'animate-spin' : ''} /> {loading ? 'Carregando' : 'Atualizar'}
                                </button>
                            </div>
                        </header>

                        {error && (
                            <div className="mb-6 bg-red-500/10 border border-red-500/20 p-4 rounded-xl flex items-start gap-3">
                                <Icons.AlertCircle className="text-red-400 shrink-0 mt-0.5" />
                                <div className="text-red-300 text-sm">
                                    <strong className="block mb-1 text-red-400">Erro de Conex√£o</strong>
                                    {error}
                                    <p className="mt-2 text-xs opacity-70">Se estiver usando GitHub, verifique se o Apps Script est√° publicado como "Executar como: Eu" e "Acesso: Qualquer pessoa".</p>
                                </div>
                            </div>
                        )}

                        {!stats && !loading && !error && (
                            <div className="text-center py-20 text-slate-500">Nenhum dado. Clique em Atualizar.</div>
                        )}

                        {stats && (
                            <>
                                {activeTab === 'dashboard' && <DashboardTab stats={stats} lastGame={data[0]} />}
                                {activeTab === 'analysis' && <AnalysisTab stats={stats} />}
                                {activeTab === 'generator' && <GeneratorTab stats={stats} lastGame={data[0]} saveGame={(g) => setMyGames([g, ...myGames])} />}
                                {activeTab === 'mygames' && <MyGamesTab games={myGames} setGames={setMyGames} history={data} />}
                                {activeTab === 'simulator' && <SimulatorTab history={data} />}
                            </>
                        )}
                    </main>
                </div>
            );
        };

        // Renderiza√ß√£o
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
